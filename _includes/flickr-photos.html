<ul class="photos-list">
  {% for photo in site.data['flickr-photos'] %}
    <li class="photo">
      <a href="{{ photo.flickr_page_url }}" class="lazy-load" data-id="{{ photo.id }}" data-background-image="{{ photo.url_s }}" target="_blank"></a>
    </li>
  {% endfor %}
</ul>

<div class="site-overlay">
    <ul class="photos-slideshow">
    {% for photo in site.data['flickr-photos'] %}
      <li class="photo" data-id="{{ photo.id }}">
        <a href="{{ photo.flickr_page_url }}" data-background-image="{{ photo.url_o }}" target="_blank"></a>
      </li>
    {% endfor %}
  </ul>
</div>


<script>
  const photos = document.querySelectorAll('.photos-list .photo a');
  for (let photo of photos) {
    photo.addEventListener('click', function(evt) {
      //console.log(evt);
      evt.preventDefault();
      document.querySelector('.site-overlay').classList.add('site-overlay-visible');
      document.querySelector('.photos-list').classList.add('photos-list-slide-right');
      document.querySelector('.wrapper').classList.add('wrapper-full-width');

      setTimeout(function() {
        const id = evt.target.dataset.id;
        const slideshowPhotoContainer = document.querySelector(`.photos-slideshow [data-id="${id}"]`);
        const slideshowPhoto = slideshowPhotoContainer.querySelector('a');
        
        if (slideshowPhoto) {
          const slideshowPhotoSrc = slideshowPhoto.dataset.backgroundImage;
          
          slideshowPhoto.style.backgroundImage = `url(${slideshowPhotoSrc})`;

          preloadImages( [ slideshowPhotoSrc ]).then(function() {
            slideshowPhotoContainer.classList.add('photo-current');

            Array.from(document.querySelectorAll('.photos-slideshow .photo-current')).map(function(el) {
              if (el.dataset.id !== id) {
                el.classList.remove('photo-current');

              }
            });

          });
        }
      }, 100);
      

      //console.log(slideshowPhoto);
    });
  }
</script>
